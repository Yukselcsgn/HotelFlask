{% extends "base.html" %}
{% block title %}Fiyat Y√∂netimi - Admin{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <div class="admin-header">
        <h2>üí∞ Fiyat Y√∂netimi</h2>
        <div class="admin-actions">
            <a href="{{ url_for('admin.dashboard') }}" class="back-btn">‚Üê Geri D√∂n</a>
        </div>
    </div>
    
    <div class="prices-management">
        <h3>Oda Fiyatlarƒ±nƒ± D√ºzenle</h3>
        
        <div class="price-forms">
            <form method="POST" action="{{ url_for('admin.update_price') }}" class="price-form">
                <div class="form-group">
                    <label for="room_type">Oda Tipi:</label>
                    <select name="room_type" required>
                        <option value="Standart">Standart</option>
                        <option value="Deluxe">Deluxe</option>
                        <option value="Suit">Suit</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="price">Gecelik Fiyat (‚Ç∫):</label>
                    <input type="number" name="price" step="0.01" min="0" required>
                </div>
                
                <div class="form-group">
                    <label for="description">A√ßƒ±klama:</label>
                    <textarea name="description" rows="3" placeholder="Oda √∂zellikleri ve a√ßƒ±klamalarƒ±..."></textarea>
                </div>
                
                <div class="discount-section">
                    <h4>üéØ ƒ∞ndirim Ayarlarƒ±</h4>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="is_discounted" id="is_discounted">
                            <span class="checkmark"></span>
                            ƒ∞ndirim Aktif
                        </label>
                    </div>
                    
                    <div class="form-group" id="discount_percentage_group" style="display: none;">
                        <label for="discount_percentage">ƒ∞ndirim Y√ºzdesi (%):</label>
                        <input type="number" name="discount_percentage" step="0.1" min="0" max="100" value="0">
                    </div>
                </div>
                
                <button type="submit" class="save-btn">üíæ Fiyatƒ± Kaydet</button>
            </form>
        </div>
        
        <div class="current-prices">
            <h3>Mevcut Fiyatlar</h3>
            <div class="price-cards">
                {% for price in room_prices %}
                <div class="price-card">
                    <h4>{{ price.room_type }}</h4>
                    {% if price.is_discounted and price.discount_percentage > 0 %}
                    <div class="price-display">
                        <p class="original-price">{{ price.original_price }}‚Ç∫</p>
                        <p class="discounted-price">{{ price.get_discounted_price()|round(2) }}‚Ç∫</p>
                        <p class="discount-badge">%{{ price.discount_percentage }} ƒ∞ndirim</p>
                    </div>
                    {% else %}
                    <p class="price">{{ price.price_per_night }}‚Ç∫</p>
                    {% endif %}
                    <p class="description">{{ price.description or 'A√ßƒ±klama yok' }}</p>
                    <p class="updated">Son g√ºncelleme: {{ price.updated_at.strftime('%d.%m.%Y %H:%M') }}</p>
                </div>
                {% else %}
                <p class="no-prices">Hen√ºz fiyat tanƒ±mlanmamƒ±≈ü.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// ƒ∞ndirim checkbox kontrol√º
document.getElementById('is_discounted').addEventListener('change', function() {
    const discountGroup = document.getElementById('discount_percentage_group');
    if (this.checked) {
        discountGroup.style.display = 'block';
    } else {
        discountGroup.style.display = 'none';
        document.querySelector('input[name="discount_percentage"]').value = '0';
    }
});

// Fiyat formunu doldur
document.querySelector('select[name="room_type"]').addEventListener('change', function() {
    const roomType = this.value;
    const priceCards = document.querySelectorAll('.price-card');
    
    priceCards.forEach(card => {
        if (card.querySelector('h4').textContent === roomType) {
            const priceDisplay = card.querySelector('.price-display');
            const priceElement = card.querySelector('.price');
            const description = card.querySelector('.description').textContent;
            
            let price, isDiscounted = false, discountPercentage = 0;
            
            if (priceDisplay) {
                // ƒ∞ndirimli fiyat varsa
                price = priceDisplay.querySelector('.discounted-price').textContent.replace('‚Ç∫', '');
                isDiscounted = true;
                discountPercentage = priceDisplay.querySelector('.discount-badge').textContent.match(/%(\d+(\.\d+)?)/)[1];
            } else if (priceElement) {
                // Normal fiyat
                price = priceElement.textContent.replace('‚Ç∫', '');
            }
            
            document.querySelector('input[name="price"]').value = price;
            document.querySelector('textarea[name="description"]').value = description;
            document.getElementById('is_discounted').checked = isDiscounted;
            document.querySelector('input[name="discount_percentage"]').value = discountPercentage;
            
            // ƒ∞ndirim alanƒ±nƒ± g√∂ster/gizle
            const discountGroup = document.getElementById('discount_percentage_group');
            discountGroup.style.display = isDiscounted ? 'block' : 'none';
        }
    });
});
</script>
{% endblock %} 